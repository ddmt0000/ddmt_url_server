<h1>DDMT add</h1>
<p>è¾“å…¥åŸå§‹é“¾æ¥ï¼š</p>
<mdui-text-field class="example-text" prefix="" label="url"><mdui-button-icon id="content_paste" icon="content_paste"
        slot="end-icon"></mdui-button-icon></mdui-text-field>
        <mdui-checkbox id="checkbox_row">å¤šè¡Œæ‰¹é‡æ·»åŠ </mdui-checkbox>
<mdui-text-field readonly id="newurl" value="newurl" style="display:none;"><mdui-button-icon id="content_copy" icon="content_copy"
        slot="end-icon"></mdui-button-icon></mdui-text-field>
        
<p></p>
<mdui-button full-width onclick="add_url();"><mdui-icon name='add_link'></mdui-icon>add</mdui-button>
<script>
    const urlprint = document.querySelector("mdui-text-field[id='newurl']");
    const checkbox_row = document.getElementById("checkbox_row");
    const urlInput = document.querySelector("mdui-text-field");
    const content_paste = document.getElementById("content_paste");
    const content_copy = document.getElementById("content_copy");
    const cut = navigator.clipboard;

    function cut_writetext(text) {
        if (cut == null) {
            snackbar_tip("è¯¥æµè§ˆå™¨ä¸æ”¯æŒå†™å…¥å‰ªè¾‘ç‰ˆï¼Œæ¨èä½¿ç”¨Chrome");
        } else {
            if (cut.writeText(text)) {
                snackbar_tip("å·²å¤åˆ¶åˆ°å‰ªè¾‘ç‰ˆ");
            } else {
                snackbar_tip("æ— æ³•å®Œæ•´å¤åˆ¶");
            }
        }
    } 

    content_copy.addEventListener("click",()=>{
        cut_writetext(urlprint.PromiseResult);
    });
    content_paste.addEventListener("click",()=>{
        var getcut = false; //å¦‚æœç”¨æˆ·çŠ¹è±«ä¼šé™„ä¸Šè´´å¿ƒå°æç¤ºï¼Œæˆ–è®¸ä¼šæœ‰æ›´å¥½çš„åŠæ³•
        cut.readText().then(function(result) {
            urlInput.value = result;
            getcut = true;
        }).catch(function(error) {
            if(error.name === "NotAllowedError"){snackbar_tip("æœ€åï¼Œè¿˜æ˜¯è¢«ä½ æ‹’ç»äº†å—ï¼ŸğŸ˜¿");}else{snackbar_tip(error.message);}
            getcut = true;
        });
        setTimeout(()=>{
            if(getcut === false){
                snackbar_tip("ä½ æ— éœ€æ‹…å¿ƒï¼Œå¤§å¯ä»¥ç›´æ¥å…è®¸ï¼Œå› ä¸ºè¯¥æƒé™ä»…ç”¨äºå¿«æ·ç²˜è´´ã€‚");
            }
        },"500");
    });
    checkbox_row.addEventListener("change",(even)=>{
        // console.log("å¼€å…³æŒ‰ä¸‹");
        // console.log(switch_row.checked);
        if(checkbox_row.checked){
            urlInput.setAttribute('rows', '5'); //å…è®¸äº”è¡Œè§£æ
            urlprint.setAttribute('rows', '5'); 
        }else{
            urlInput.removeAttribute('rows');
            urlprint.removeAttribute('rows');
        }
    });

    function add_url() {
        var submitbutton = document.querySelector("mdui-button");
        var url = urlInput.value;
        submitbutton.loading = true;
        console.log(submitbutton.loading);        
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "/?mod=add&url_orange=" + encodeURIComponent(url), true);
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                // è¯·æ±‚æˆåŠŸ
                var responses = JSON.parse(xhr.responseText);
                var printtext = "";
                for (var i in responses){
                    console.log(responses);
                    var code = responses[i].code;
                    var newUrl = responses[i].newurl;
                    var msg = responses[i].msg;                
                    console.log("code: " + code);
                    console.log("newUrl: " + newUrl);
                    console.log("msg: " + msg);
                    if (code == 1) {
                        // urlprint.value = newUrl;
                        var printtext = printtext + newUrl + "\n";
                        // snackbar_tip(msg);
                    } else {
                        var printtext = printtext + msg + "\n";
                        // snackbar_tip(msg);
                    }
                };
                urlprint.style.display = "block";
                urlprint.value = printtext.slice(0, -1);
                snackbar_tip("æ·»åŠ æˆåŠŸ");
            } else {
                if (xhr.readyState >= 4 && xhr.status != 200) {
                    snackbar_tip("è¯·æ±‚å¤±è´¥");
                }
            }
        };
        submitbutton.loading = false;
        xhr.send();
    }
</script>